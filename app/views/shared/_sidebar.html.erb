<div id="sidebar">
  <div id="box1" class="box-style">
    <div class="title">
      <h2><span>Categorías destacadas</span></h2>
    </div>
    <div class="content">
      <ul>
        <li><%= link_to "Últimas novedades (#{Product.new_arrivals.count})", new_arrivals_path %></li>
        <li><%= link_to_search_products "cuencos y ensaladeras" %></li>
        <li><%= link_to_search_products "macetas" %></li>
        <li><%= link_to_search_products "cazuelas" %></li>
      </ul>
      <p><%= link_to "Ver todas las categorías", categories_path, :class => "link1" %></p>
    </div>
  </div>
  <div id="box2" class="box-style">
    <div class="title">
      <h2><span>Otras categorías</span></h2>
    </div>
    <div class="content">
      <ul>
        <% Category.order(:position).all.each do |category| %>
          <li><%= link_to "#{category.name} (#{category.products.accessible_by(current_ability).count})", category_products_path(category) %></li>
        <% end %>
      </ul>
    </div>
    <% if params[:foobar].present? %>
    <div class="title" style="margin-top: 20px;">
      <h2><span>Decoraciones</span></h2>
    </div>
    <div class="content">
      <% Category.order(:position).all.each do |category| %>
        <% decorations = category.products.accessible_by(current_ability).where(:decoration_code => Decoration::DECORATIONS.keys).group(:decoration_code).count %>
        <% if decorations.any? %>
          <h3>Decoraciones de <%= category.name %></h3>
          <ul>
            <% decorations.each do |decoration_code, count| %>
              <li><%= link_to "#{Decoration.new(decoration_code).name} (#{count})", category_products_path(category, :decoration_code => decoration_code) %></li>
            <% end %>
          </ul>
        <% end %>
      <% end %>
    </div>
    <% end %>
  </div>
</div>
